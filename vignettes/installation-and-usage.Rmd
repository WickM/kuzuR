---
title: "Installation and Basic Usage"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Installation and Basic Usage}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

This vignette provides a step-by-step guide to installing the `kuzuR` package and its dependencies, and demonstrates its basic usage for connecting to a Kuzu database, creating a schema, loading data, and executing simple queries.

## Installation

First, you need to install the `kuzuR` package from GitHub. #TODO add CRAN

```{r, eval=FALSE}
devtools::install_github("WickM/kuzuR")
```

`kuzuR` relies on the official Python `kuzu` library. To manage the Python dependencies, `kuzuR` provides a helper function `install_kuzu()`. This function will install the necessary Python packages into a dedicated environment using `reticulate`.

```{r, eval=FALSE}
library(kuzuR)
install_kuzu()
```

## Basic Usage

Once the package and its dependencies are installed, you can start using `kuzuR` to interact with a Kuzu database.

### 1. Load the library

```{r}
library(kuzuR)
```

### 2. Create a Connection

To get started, you need to create a connection to a Kuzu database. You can either connect to an on-disk database by providing a path or create a temporary in-memory database. If the database at the specified path does not exist, it will be created for you.

```{r}
# Create a temporary on-disk database
db_path <- tempfile()
con <- kuzu_connection(db_path)

# Alternatively, create an in-memory database (data is lost when R session ends)
con <- kuzu_connection(":memory:")
```

### 3. Define a Schema

Let's create a simple schema with a `Person` node table and a `Knows` relationship table.

#TODO Add R typte

| **Python type** | **Kuzu `LogicalTypeID`** |
|-----------------|--------------------------|
| `bool`          | `BOOL`                   |
| `int`           | `INT64`                  |
| `float`         | `DOUBLE`                 |
| `str`           | `STRING`                 |
| `datetime`      | `TIMESTAMP`              |
| `date`          | `DATE`                   |
| `timedelta`     | `INTERVAL`               |
| `uuid`          | `UUID`                   |
| `list`          | `LIST`                   |
| `dict`          | `MAP`                    |

```{r}
kuzu_execute(con, paste("CREATE NODE TABLE Person(name STRING, age INT64,",
                        "PRIMARY KEY (name))"))
kuzu_execute(con, "CREATE REL TABLE Knows(FROM Person TO Person, since INT64)")
```

### 4. Load Data

You can load data into your tables from R data frames using `kuzu_copy_from_df()`.

```{r}
# Create data frames for nodes and relationships
persons <- data.frame(
  name = c("Alice", "Bob", "Carol"),
  age = c(35, 45, 25)
)

knows <- data.frame(
  from_person = c("Alice", "Bob"),
  to_person = c("Bob", "Carol"),
  since = c(2010, 2015)
)

# Load data into Kuzu
kuzu_copy_from_df(con, persons, "Person")
kuzu_copy_from_df(con, knows, "Knows")
```

### 5. Execute Queries

Now you can execute Cypher queries and retrieve the results.

```{r}
#TODO add diferent result methodes
#todo add glue and stick to ("COPY Person FROM ... method)
"COPY Person FROM {persons}"
"COPY Person FROM {c://.csv}"
"COPY Person FROM {c://.json}"
"COPY Person FROM {c://.json}"



# Find all persons
result <- kuzu_execute(con, "MATCH (p:Person) RETURN p.name, p.age")
as.data.frame(result)

kuzu_get_all(result)
```

```{r}
# Find relationships
result_rel <- kuzu_execute(con, paste("MATCH (a:Person)-[k:Knows]->(b:Person)",
                                      "RETURN a.name, k.since, b.name"))
as.data.frame(result_rel)
```

This concludes the basic introduction to `kuzuR`. For more advanced topics, such as graph library integrations, please see the other vignettes.

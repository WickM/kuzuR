---
title: "Graph Library Integrations"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Graph Library Integrations}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

This vignette demonstrates how to convert Kuzu query results into various R graph library objects, including `igraph`, `tidygraph`, and `g6R`. It showcases the seamless integration of `kuzuR` with popular R packages for graph analysis and visualization.

## Prerequisites

Ensure you have the necessary packages installed:

```{r, eval=FALSE}
# install.packages("igraph")
# install.packages("tidygraph")
# install.packages("g6R")
# install.packages("kuzuR") # If not already installed
```

## Converting to `igraph`

The `igraph` package is a powerful tool for graph manipulation and analysis in R. `kuzuR` provides a direct conversion function `as_igraph()` to transform Kuzu query results into `igraph` objects.

### Example: Loading and Converting Graph Data

First, let's set up a Kuzu database and load some sample graph data.

```{r}
library(kuzuR)
library(igraph)

# Create a connection
db_path <- tempfile()
con <- kuzu_connection(db_path)

# Create schema for nodes and relationships
kuzu_execute(con, "CREATE NODE TABLE Person(name STRING, age INT64, PRIMARY KEY (name))")
kuzu_execute(con, "CREATE REL TABLE Knows(FROM Person TO Person, since INT64)")

# Prepare data frames
persons_data <- data.frame(
  name = c("Alice", "Bob", "Carol"),
  age = c(35, 45, 25)
)

knows_data <- data.frame(
  from_person = c("Alice", "Bob"),
  to_person = c("Bob", "Carol"),
  since = c(2010, 2015)
)

# Load data into Kuzu
kuzu_copy_from_df(con, persons_data, "Person")
kuzu_copy_from_df(con, knows_data, "Knows")
```

Now, let's execute a query that returns graph data and convert it to an `igraph` object.

```{r}
# Query to get all persons and their relationships
graph_query_result <- kuzu_execute(con, "MATCH (p1:Person)-[k:Knows]->(p2:Person) RETURN p1, p2, k.since")

# Convert the Kuzu result to an igraph object
igraph_graph <- as_igraph(graph_query_result)

# Print the igraph object summary
print(igraph_graph)
```

You can now perform standard `igraph` operations on `igraph_graph`.

## Converting to `tidygraph`

The `tidygraph` package offers a tidy data approach to graph manipulation, integrating seamlessly with the tidyverse. `kuzuR` supports conversion to `tidygraph` objects via `as_tidygraph()`.

### Example: Converting to `tidygraph`

Using the same Kuzu query result, we can convert it to a `tidygraph` object.

```{r}
# Convert the Kuzu result to a tidygraph object
tidygraph_graph <- as_tidygraph(graph_query_result)

# Print the tidygraph object summary
print(tidygraph_graph)
```

## Interactive Visualization with `g6R`

The `g6R` package provides an R interface to the G6 JavaScript graph visualization library, enabling rich, interactive visualizations directly within R environments. The `as_g6R()` function makes it straightforward to take graph data from Kuzu and create these visualizations.

### Example: Creating an Interactive `g6R` Graph

Building on the previous examples, we can convert the Kuzu query result into a `g6R` object. We can then customize the appearance of the nodes and edges for a more informative visualization.

```{r}
# Convert the Kuzu result to a g6R object
g6r_graph <- as_g6R(graph_query_result)

# Customize the g6R graph for better visualization
# For example, let's color the nodes based on their label and display the 'since' property on edges
g6r_graph <- g6r_graph |>
  g6R::upsert_node_options(
    label = ~.data$properties$name,
    style = list(
      fill = "#5B8FF9",
      stroke = "#3D76E0"
    )
  ) |>
  g6R::upsert_edge_options(
    label = ~.data$properties$since,
    style = list(
      endArrow = TRUE
    )
  )

# Display the g6R object (this will render an interactive visualization)
# In a real interactive session (like RStudio), this would display the plot.
# For this vignette, we'll just print the object structure.
print(g6r_graph)
```

This interactive visualization allows you to pan, zoom, and inspect nodes and edges, making it a powerful tool for exploring graph data retrieved from Kuzu.

This concludes the vignette on graph library integrations. For more advanced usage and specific examples, please refer to the documentation of each respective library.

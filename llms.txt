# kuzuR

## Overview

`kuzuR` provides an R interface to the [Kuzu Graph
Database](https://kuzudb.github.io/docs/), a high-performance, embedded
graph database. The package acts as a wrapper around the official Python
`kuzu` client, using the `reticulate` package to bridge the two
languages. This allows you to interact with Kuzu seamlessly within your
R environment, integrating its powerful graph computation capabilities
into your existing data analysis workflows.

The primary goal of `kuzuR` is to provide an idiomatic R experience
for: - Creating and managing Kuzu database instances. - Executing Cypher
queries. - Loading data from and retrieving results into R data frames
and tibbles. - Converting graph query results directly into R-native
graph objects like `igraph` and `tidygraph`.

## Installation

`kuzuR` requires a working Python installation with the `kuzu`,
`pandas`, and `networkx` packages.

1.  **Install the R Package**

You can install the development version from GitHub:

``` r
# install.packages("pak")
pak::pak("WickM/kuzuR")
```

Or the stable version from CRAN:

``` r
# install.packages("kuzuR")
```

2.  **Install Python Dependencies**

After installing `kuzuR`, you must install the required Python packages.
You can do this from your R console using `reticulate`:

``` r
library(kuzuR)
reticulate::py_install(c("kuzu", "pandas", "networkx"), pip = TRUE)
```

3.  **Verify Installation**

You can check that all dependencies are correctly installed by running:

``` r
check_kuzu_installation()
#> The 'kuzu', 'pandas', and 'networkx' Python packages are installed and available.
```

## Usage

Here is a complete example demonstrating how to create a database,
define a schema, load data, and run queries.

``` r
library(kuzuR)
library(igraph)
library(tidygraph)

# 1. Create a database in a temporary directory
db_path <- tempfile()
con <- kuzu_connection(db_path)

# 2. Define a schema
# Create a 'Person' node table with a STRING name and INT64 age
schema_query_1 <- "CREATE NODE TABLE Person (
  name STRING,
  age INT64,
  PRIMARY KEY (name)
)"
kuzu_execute(con, schema_query_1)
#> <kuzu.query_result.QueryResult object at 0x00000230F2280050>

# Create a 'Knows' relationship table
schema_query_2 <- "CREATE REL TABLE Knows(FROM Person TO Person, since INT64)"
kuzu_execute(con, schema_query_2)
#> <kuzu.query_result.QueryResult object at 0x00000230F2153D90>

# 3. Load data from R data frames
# Create node data
nodes <- data.frame(
  name = c("Alice", "Bob", "Carol"),
  age = c(30, 40, 50)
)

# Create edge data
edges <- data.frame(
  from_person = c("Alice", "Bob"),
  to_person = c("Bob", "Carol"),
  since = c(2010, 2015)
)

# Use kuzu_copy_from_df to load the data
kuzu_copy_from_df(con, nodes, "Person")

names(edges) <- c("FROM", "TO", "since")
kuzu_copy_from_df(con, edges, "Knows")

# 4. Execute Cypher queries
# Retrieve data as a data frame
query_result <- kuzu_execute(con, "MATCH (p:Person) RETURN p.name, p.age")
as.data.frame(query_result)
#>   p.name p.age
#> 1  Alice    30
#> 2    Bob    40
#> 3  Carol    50

# 5. Convert graph results to R objects
# The same query result can be converted into different graph formats.
graph_result <- kuzu_execute(con, "MATCH (a:Person)-[k:Knows]->(b:Person) RETURN a, k, b")

# a) Convert to an igraph object
g_igraph <- as_igraph(graph_result)
print(g_igraph)
#> IGRAPH 18d3706 DN-- 3 2 -- 
#> + attr: name (v/c), age (v/n), Person (v/l), label (v/c), _id (e/x),
#> | _dst (e/x), since (e/n), _label (e/c), _src (e/x)
#> + edges from 18d3706 (vertex names):
#> [1] Person_Alice->Person_Bob   Person_Bob  ->Person_Carol
plot(g_igraph)

# b) Convert to a tidygraph object
g_tidy <- as_tidygraph(graph_result)
print(g_tidy)
#> # A tbl_graph: 3 nodes and 2 edges
#> #
#> # A rooted tree
#> #
#> # Node Data: 3 × 4 (active)
#>   name           age Person label 
#>   <chr>        <dbl> <lgl>  <chr> 
#> 1 Person_Alice    30 TRUE   Person
#> 2 Person_Bob      40 TRUE   Person
#> 3 Person_Carol    50 TRUE   Person
#> #
#> # Edge Data: 2 × 7
#>    from    to `_id`            `_dst`           since `_label` `_src`          
#>   <int> <int> <list>           <list>           <dbl> <chr>    <list>          
#> 1     1     2 <named list [2]> <named list [2]>  2010 Knows    <named list [2]>
#> 2     2     3 <named list [2]> <named list [2]>  2015 Knows    <named list [2]>

# 6. Inspecting Query Results
# You can inspect the schema of a query result without converting it to a data frame.
# Get column names
kuzu_get_column_names(query_result)
#> [1] "p.name" "p.age"

# Get column data types
kuzu_get_column_data_types(query_result)
#> [1] "STRING" "INT64"

# Get the full schema as a named list
kuzu_get_schema(query_result)
#> $p.name
#> [1] "STRING"
#> 
#> $p.age
#> [1] "INT64"
```

![Plot of the graph structure created from Kuzu query
results.](reference/figures/README-example-1.png)

Plot of the graph structure created from Kuzu query results.

## Learning and Getting Help

- For more detailed examples and workflows, please see the package
  vignettes.
- For more detailed examples on how to use kuzu Query see [kuzu
  documentation](https://kuzudb.github.io/docs/)
- If you encounter a bug or have a feature request, please file an issue
  on [GitHub](https://github.com/WickM/kuzuR/issues).

# Package index

## Core Kuzu Connection and Querying

- [`kuzu_connection()`](https://wickm.github.io/kuzuR/reference/kuzu_connection.md)
  : Create a Connection to a Kuzu Database
- [`kuzu_execute()`](https://wickm.github.io/kuzuR/reference/kuzu_execute.md)
  : Execute a Cypher Query
- [`kuzu_get_all()`](https://wickm.github.io/kuzuR/reference/kuzu_get_all.md)
  : Retrieve All Rows from a Query Result
- [`kuzu_get_n()`](https://wickm.github.io/kuzuR/reference/kuzu_get_n.md)
  : Retrieve the First N Rows from a Query Result
- [`kuzu_get_next()`](https://wickm.github.io/kuzuR/reference/kuzu_get_next.md)
  : Retrieve the Next Row from a Query Result
- [`kuzu_get_column_names()`](https://wickm.github.io/kuzuR/reference/kuzu_get_column_names.md)
  : Get Column Names from a Query Result
- [`kuzu_get_column_data_types()`](https://wickm.github.io/kuzuR/reference/kuzu_get_column_data_types.md)
  : Get Column Data Types from a Query Result
- [`kuzu_get_schema()`](https://wickm.github.io/kuzuR/reference/kuzu_get_schema.md)
  : Get Schema from a Query Result

## Data Loading

- [`kuzu_copy_from_csv()`](https://wickm.github.io/kuzuR/reference/kuzu_copy_from_csv.md)
  : Load Data from a CSV File into a Kuzu Table
- [`as.data.frame(`*`<kuzu.query_result.QueryResult>`*`)`](https://wickm.github.io/kuzuR/reference/as.data.frame.kuzu.query_result.QueryResult.md)
  : Convert a Kuzu Query Result to a Data Frame
- [`as_tibble(`*`<kuzu.query_result.QueryResult>`*`)`](https://wickm.github.io/kuzuR/reference/as_tibble.kuzu.query_result.QueryResult.md)
  : Convert a Kuzu Query Result to a Tibble
- [`kuzu_copy_from_df()`](https://wickm.github.io/kuzuR/reference/kuzu_copy_from_df.md)
  : Load Data from a Data Frame or Tibble into a Kuzu Table
- [`kuzu_copy_from_json()`](https://wickm.github.io/kuzuR/reference/kuzu_copy_from_json.md)
  : Load Data from a JSON File into a Kuzu Table
- [`kuzu_copy_from_parquet()`](https://wickm.github.io/kuzuR/reference/kuzu_copy_from_parquet.md)
  : Load Data from a Parquet File into a Kuzu Table
- [`kuzu_merge_df()`](https://wickm.github.io/kuzuR/reference/kuzu_merge_df.md)
  : Merge Data from a Data Frame into Kuzu using a Merge Query

## Graph Integrations

- [`as_igraph()`](https://wickm.github.io/kuzuR/reference/as_igraph.md)
  : Convert a Kuzu Query Result to an igraph Object
- [`as_tidygraph()`](https://wickm.github.io/kuzuR/reference/as_tidygraph.md)
  : Convert a Kuzu Query Result to a tidygraph Object

## Installation

- [`check_kuzu_installation()`](https://wickm.github.io/kuzuR/reference/check_kuzu_installation.md)
  : Check for Kuzu Python Dependencies

# Articles

### Getting Started

- [Getting Started with
  kuzuR](https://wickm.github.io/kuzuR/articles/getting-started.md):

### Installation and Usage

- [Installation and Basic
  Usage](https://wickm.github.io/kuzuR/articles/installation-and-usage.md):

### Graph Library Integrations

- [Graph Library
  Integrations](https://wickm.github.io/kuzuR/articles/graph-integrations.md):
